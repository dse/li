#!/usr/bin/env bash
set -o errexit
set -o pipefail
set -o nounset
shopt -s lastpipe
# set -o xtrace

main () {
    set_excludes
    exec grep "${exclude_dirs[@]}" "${exclude_files[@]}" \
         --binary-files=without-match --recursive "$@"
}

declare -a exclude_dirs=()
declare -a exclude_files=()

set_excludes () {
    exclude_dirs+=(
        --exclude-dir='vendor'
        --exclude-dir='node_modules'
        --exclude-dir='.cache'
        --exclude-dir='.cpan'

        # version control
        --exclude-dir='.git'
        --exclude-dir='.svn'

        # others from emacs grep.el
        --exclude-dir='SCCS'
        --exclude-dir='RCS'
        --exclude-dir='CVS'
        --exclude-dir='MCVS'
        --exclude-dir='.src'
        --exclude-dir='.hg'
        --exclude-dir='.bzr'
        --exclude-dir='_MTN'
        --exclude-dir='_darcs'
        --exclude-dir='{arch}'
        --exclude-dir='.sass-cache'

        # BigCommerce
        --exclude-dir='parsed/templates'
        --exclude-dir='parsed/scss'

        # emacs
        --exclude-dir='elpa'

        # etc.
        --exclude-dir='zip-cache'
    )
    exclude_files+=(
        # backups
        --exclude='*~'
        --exclude='#*#'
        --exclude='.*~'
        --exclude='.#*'
        --exclude='*.bak'
        --exclude='*.tmp'
        --exclude='*.old'
        --exclude='*.orig'
        --exclude='*.bak.*'
        --exclude='*.tmp.*'
        --exclude='*.old.*'
        --exclude='*.orig.*'

        # archives
        --exclude='*.zip'
        --exclude='*.jar'
        --exclude='*.sym'

        # compressed files
        --exclude='*.gz'

        # minified/map files
        --exclude='*.min'
        --exclude='*.min.*'
        --exclude='*.css.map'
        --exclude='*.js.map'
        --exclude='*.min.map'
        --exclude='composer.lock'
        --exclude='*.bundle.js'

        # BigCommerce minified
        --exclude='theme-bundle.main.js'
        --exclude='theme.scss.json'
        --exclude='assets/dist/report.html'
        --exclude='parsed/lang.json'
        --exclude='theme-bundle.chunk.*.js'
        --exclude='theme-bundle.head_async.js'

        # projectile
        --exclude='projectile.cache'

        # emacs
        --exclude='ido.last'

        # images
        --exclude='*.gif'
        --exclude='*.jpg'
        --exclude='*.jpeg'
        --exclude='*.png'
        --exclude='*.webp'

        # fonts
        --exclude='*.ttf'
        --exclude='*.otf'
        --exclude='*.ttc'
        --exclude='*.woff'
        --exclude='*.eot'

        # executables and libraries
        --exclude='*.exe'
        --exclude='*.a'
        --exclude='*.o'
        --exclude='*.so'
        --exclude='*.dll'
        --exclude='*.dylib'

        # Legacy Microsoft Office
        --exclude='*.doc'
        --exclude='*.ppt'
        --exclude='*.xls'

        # Media
        --exclude='*.mov'
        --exclude='*.m4a'
        --exclude='*.qt'
        --exclude='*.wma'
        --exclude='*.mp3'
        --exclude='*.m4r'
        --exclude='*.flv'
        --exclude='*.wmv'
        --exclude='*.swf'

        # Dalvik
        --exclude='*.dex'

        # Java
        --exclude='*.class'

        # Misc.
        --exclude='*.bin'
        --exclude='*.lbin'
        --exclude='*.flat'

        # Others from emacs grep.el.  I--exclude='m assuming these are binary
        # formats.
        --exclude='*.ln'
        --exclude='*.blg'
        --exclude='*.bbl'
        --exclude='*.elc'
        --exclude='*.lof'
        --exclude='*.glo'
        --exclude='*.idx'
        --exclude='*.lot'
        --exclude='*.fmt'
        --exclude='*.tfm'
        --exclude='*.fas'
        --exclude='*.lib'
        --exclude='*.mem'
        --exclude='*.x86f'
        --exclude='*.sparcf'
        --exclude='*.dfsl'
        --exclude='*.pfsl'
        --exclude='*.d64fsl'
        --exclude='*.p64fsl'
        --exclude='*.lx64fsl'
        --exclude='*.lx32fsl'
        --exclude='*.dx64fsl'
        --exclude='*.dx32fsl'
        --exclude='*.fx64fsl'
        --exclude='*.fx32fsl'
        --exclude='*.sx64fsl'
        --exclude='*.sx32fsl'
        --exclude='*.wx64fsl'
        --exclude='*.wx32fsl'
        --exclude='*.fasl'
        --exclude='*.ufsl'
        --exclude='*.fsl'
        --exclude='*.dxl'
        --exclude='*.lo'
        --exclude='*.la'
        --exclude='*.gmo'
        --exclude='*.mo'
        --exclude='*.toc'
        --exclude='*.aux'
        --exclude='*.cp'
        --exclude='*.fn'
        --exclude='*.ky'
        --exclude='*.pg'
        --exclude='*.tp'
        --exclude='*.vr'
        --exclude='*.cps'
        --exclude='*.fns'
        --exclude='*.kys'
        --exclude='*.pgs'
        --exclude='*.tps'
        --exclude='*.vrs'
        --exclude='*.pyc'
        --exclude='*.pyo'
        --exclude='*.ri'

        # anroid lol
        --exclude='*.apk'
        --exclude='*.aab'
        --exclude='*.dex'
        --exclude='*.ap_'

        --exclude='*.doc'
        --exclude='*.docx'
        --exclude='*.xls'
        --exclude='*.xlsx'
        --exclude='*.ppt'
        --exclude='*.pptx'
        --exclude='*.pdf'
        --exclude='*.ps'
        --exclude='*.sfd'      # FontForge fonts
    )
}

#------------------------------------------------------------------------------
main "$@"
